(function(a){function r(a){return typeof a=="undefined"?!1:!0}function s(b){var c=/^((?:[*]|(?:\d+(?:-\d+)?)(?:,\d+(?:-\d+)?)*)\s){4}(?:[*]|(?:\d+(?:-\d+)?)(?:,\d+(?:-\d+)?)*)$/;if(typeof b!="string"||!c.test(b))return a.error("cron: invalid initial value"),undefined;var d=b.split(" "),e=[0,0,1,1,0],f=[59,23,31,12,6];for(var g=0;g<d.length;g++){if(d[g]=="*")continue;if(d[g].indexOf(",")){var h=d[g].split(",");if(Math.max.apply(null,h)<=f[g]&&Math.min.apply(null,h)>=e[g])continue}else{var i=parseInt(d[g]);if(r(i)&&i<=f[g]&&i>=e[g])continue}return a.error("cron: invalid value found (col "+(g+1)+") in "+o.initial),undefined}for(var j in q)if(q[j].test(b))return j;return a.error("cron: valid but unsupported cron format. sorry."),undefined}function t(a,b){return r(s(b.initial))?!1:!0}function u(a){var b=a.data("block"),c=hour=day=month=dow="*";switch(b.period.find("select").val()){case"hour":c=b.mins.find("select").val();break;case"day":c=b.time.find("select.cron-time-min").val(),hour=b.time.find("select.cron-time-hour").val();break;case"week":c=b.time.find("select.cron-time-min").val(),hour=b.time.find("select.cron-time-hour").val(),dow=b.dow.find("select").val();break;case"month":c=b.time.find("select.cron-time-min").val(),hour=b.time.find("select.cron-time-hour").val(),day=b.dom.find("select").val();break;case"year":c=b.time.find("select.cron-time-min").val(),hour=b.time.find("select.cron-time-hour").val(),day=b.dom.find("select").val(),month=b.month.find("select").val()}return[c,hour,day,month,dow].join(" ")}var b={initial:"* * * * *",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:undefined,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:undefined,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:undefined,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:undefined,title:undefined},dowOpts:{minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:undefined,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:undefined,onChange:undefined},c="";for(var d=0;d<60;d++){var e=d<10?"0":"";c+="<option value='"+d+"'>"+e+d+"</option>\n"}var f="";for(var d=0;d<24;d++){var e=d<10?"0":"";f+="<option value='"+d+"'>"+e+d+"</option>\n"}var g="";for(var d=1;d<32;d++){if(d==1||d==21)var h="st";else if(d==2||d==22)var h="nd";else if(d==3||d==23)var h="rd";else var h="th";g+="<option value='"+d+"'>"+d+h+"</option>\n"}var i="",j=["January","February","March","April","May","June","July","August","September","October","November","December"];for(var d=0;d<j.length;d++)i+="<option value='"+(d+1)+"'>"+j[d]+"</option>\n";var k="",l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(var d=0;d<l.length;d++)k+="<option value='"+d+"'>"+l[d]+"</option>\n";var m="",n=["minute","hour","day","week","month","year"];for(var d=0;d<n.length;d++)m+="<option value='"+n[d]+"'>"+n[d]+"</option>\n";var p={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]},q={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}(,\d{1,2})*\s(\*\s){3}\*$/,day:/^(\d{1,2}(,\d{1,2})*\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}(,\d{1,2})*\s){2}(\*\s){2}\d{1,2}(,\d{1,2})*$/,month:/^(\d{1,2}(,\d{1,2})*\s){3}\*\s\*$/,year:/^(\d{1,2}(,\d{1,2})*\s){4}\*$/},v={init:function(d){var e=a.extend([],b,d),h=a.extend({},b.effectOpts,d.effectOpts);a.extend(e,{minuteOpts:a.extend({},b.minuteOpts,h,d.minuteOpts),domOpts:a.extend({},b.domOpts,h,d.domOpts),monthOpts:a.extend({},b.monthOpts,h,d.monthOpts),dowOpts:a.extend({},b.dowOpts,h,d.dowOpts),timeHourOpts:a.extend({},b.timeHourOpts,h,d.timeHourOpts),timeMinuteOpts:a.extend({},b.timeMinuteOpts,h,d.timeMinuteOpts)});if(t(this,e))return this;var j=[];return j.period=a("<span class='cron-period'>Every <select name='cron-period'>"+m+"</select> </span>").appendTo(this).find("select").bind("change.cron",w.periodChanged).data("root",this).gentleSelect(h).end(),j.dom=a("<span class='cron-block cron-block-dom'> on the <select multiple name='cron-dom'>"+g+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(e.domOpts).data("root",this).end(),j.month=a("<span class='cron-block cron-block-month'> of <select multiple name='cron-month'>"+i+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(e.monthOpts).data("root",this).end(),j.mins=a("<span class='cron-block cron-block-mins'> at <select multiple name='cron-mins'>"+c+"</select> minutes past the hour </span>").appendTo(this).data("root",this).find("select").gentleSelect(e.minuteOpts).data("root",this).end(),j.dow=a("<span class='cron-block cron-block-dow'> on <select multiple name='cron-dow'>"+k+"</select> </span>").appendTo(this).data("root",this).find("select").gentleSelect(e.dowOpts).data("root",this).end(),j.time=a("<span class='cron-block cron-block-time'> at <select multiple name='cron-time-hour' class='cron-time-hour'>"+f+"</select>:<select multiple name='cron-time-min' class='cron-time-min'>"+c+" </span>").appendTo(this).data("root",this).find("select.cron-time-hour").gentleSelect(e.timeHourOpts).data("root",this).end().find("select.cron-time-min").gentleSelect(e.timeMinuteOpts).data("root",this).end(),j.controls=a("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'></span> </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",w.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",w.somethingChanged),this.data("options",e).data("block",j),this.data("current_value",e.initial),v.value.call(this,e.initial)},value:function(b){if(!b)return u(this);var c=s(b);if(!r(c))return!1;var d=this.data("block"),e=b.split(" "),f={mins:e[0],hour:e[1],dom:e[2],month:e[3],dow:e[4]},g=p[c];for(var h=0;h<g.length;h++){var i=g[h];if(i=="time"){var j=f.hour.split(","),k=f.mins.split(","),l=d[i].find("select.cron-time-hour"),m=d[i].find("select.cron-time-min");l.children().each(function(b){a.inArray(a(this).attr("value"),j)>=0&&a(this).attr("selected","selected")}),m.children().each(function(b){a.inArray(a(this).attr("value"),k)>=0&&a(this).attr("selected","selected")}),l.gentleSelect("update"),m.gentleSelect("update")}else{var n=f[i].split(","),o=d[i].find("select");o.children().each(function(b){a.inArray(a(this).attr("value"),n)>=0&&a(this).attr("selected","selected")}),o.gentleSelect("update")}}return d.period.find("select").val(c).gentleSelect("update").trigger("change"),this}},w={periodChanged:function(){var b=a(this).data("root"),c=b.data("block"),d=p[a(this).val()];b.find("span.cron-block").hide();for(var e=0;e<d.length;e++)c[d[e]].show()},somethingChanged:function(){root=a(this).data("root"),r(root.data("options").url_set)?v.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var b=root.data("options").onChange;r(b)&&a.isFunction(b)&&b.call(root)},saveClicked:function(){var b=a(this),c=b.data("root"),d=v.value.call(c);if(b.hasClass("cron-loading"))return;b.addClass("cron-loading"),a.ajax({type:"POST",url:c.data("options").url_set,data:{cron:d},success:function(){c.data("current_value",d),b.removeClass("cron-loading"),d==v.value.call(c)&&(c.removeClass("cron-changed"),c.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?"),b.removeClass("cron-loading")}})}};a.fn.cron=function(b){if(v[b])return v[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return v.init.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.cron")}})(jQuery);